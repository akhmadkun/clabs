name: arista-l2ls-routing
prefix: ""

topology:
  kinds:
    ceos:
      image: ceos:4.35.0F
    linux:
      image: ghcr.io/srl-labs/network-multitool:latest
      network-mode: none

  nodes:
    spine1: { kind: ceos }
    spine2: { kind: ceos }
    leaf1:  { kind: ceos }
    leaf2:  { kind: ceos }
    
    # Host 1 - VLAN 100
    host1:
      kind: linux
      exec:
        - ip link set eth1 down
        - ip link set eth2 down
        - ip link add bond0 type bond mode 802.3ad miimon 100 lacp_rate fast
        - ip link set eth1 master bond0
        - ip link set eth2 master bond0
        - ip link set bond0 up
        - ip link set eth1 up
        - ip link set eth2 up
        - ip addr add 172.20.0.100/24 dev bond0
        - ip route add default via 172.20.0.1
        
    # Host 2 - VLAN 200
    host2:
      kind: linux
      exec:
        - ip link set eth1 down
        - ip link set eth2 down
        - ip link add bond0 type bond mode 802.3ad miimon 100 lacp_rate fast
        - ip link set eth1 master bond0
        - ip link set eth2 master bond0
        - ip link set bond0 up
        - ip link set eth1 up
        - ip link set eth2 up
        - ip addr add 172.30.0.100/24 dev bond0
        - ip route add default via 172.30.0.1

  links:
    # SPINE PEER-LINK
    - endpoints: ["spine1:eth1", "spine2:eth1"]
    - endpoints: ["spine1:eth2", "spine2:eth2"]
    
    # LEAF PEER-LINK
    - endpoints: ["leaf1:eth1", "leaf2:eth1"]
    - endpoints: ["leaf1:eth2", "leaf2:eth2"]

    # LEAF-SPINE BOW-TIE
    - endpoints: ["leaf1:eth3", "spine1:eth3"]
    - endpoints: ["leaf1:eth4", "spine2:eth3"]
    - endpoints: ["leaf2:eth3", "spine1:eth4"]
    - endpoints: ["leaf2:eth4", "spine2:eth4"]

    # DUAL-HOMED HOST 1 (VLAN 100)
    - endpoints: ["leaf1:eth5", "host1:eth1"]
    - endpoints: ["leaf2:eth5", "host1:eth2"]
    
    # DUAL-HOMED HOST 2 (VLAN 200)
    - endpoints: ["leaf1:eth6", "host2:eth1"]
    - endpoints: ["leaf2:eth6", "host2:eth2"]
